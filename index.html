<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Capslank</title>
  <meta name="description" content="متجر منتجات رائعة بفيديوهات قصيرة" />
  <style>
    /* ====================== العام ====================== */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; background: #000; color: #fff;
      font-family: Arial, Helvetica, sans-serif;
      overflow-x: hidden;
    }
    body::-webkit-scrollbar { display: none; }

    /* ====================== الهيدر ====================== */
    .header {
      position: sticky; top: 0; z-index: 100;
      background: rgba(0,0,0,0.4); backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      padding: 8px 12px;
    }
    .header-container {
      max-width: 1800px; margin: 0 auto;
      display: flex; align-items: center; gap: 12px;
    }
    .logo { color: #2f61e0; font-size: 22px; font-weight: bold; text-decoration: none; }

    .search-container { margin-left: auto; position: relative; }
    .search-input {
      width: 180px; padding: 8px 14px; border-radius: 25px; border: none;
      background: rgba(255,255,255,0.15); color: #fff; outline: none;
      transition: all 0.3s;
    }
    .search-input:focus { width: 260px; background: rgba(255,255,255,0.25); }
    .search-button {
      position: absolute; left: 4px; top: 50%; transform: translateY(-50%);
      background: transparent; border: none; color: #ccc; cursor: pointer;
    }

    /* ====================== البنر ====================== */
    .full-width-banner {
      margin: 8px 8px 16px; border-radius: 12px; overflow: hidden; position: relative;
    }
    .banner-slideshow { display: flex; transition: transform 0.5s ease; }
    .banner-slide { min-width: 100%; }
    .banner-slide img { width: 100%; height: auto; display: block; }
    .close-banner {
      position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.6);
      border: none; color: #fff; width: 36px; height: 36px; border-radius: 50%;
      cursor: pointer; z-index: 10;
    }

    /* ====================== الشبكة ====================== */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 14px;
      padding: 0 8px;
      max-width: 1800px; margin: 0 auto;
    }
    .video-item {
      background: #111; border-radius: 12px; overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      opacity: 0; transform: translateY(30px);
      transition: all 0.4s ease;
    }
    .video-item.visible { opacity: 1; transform: translateY(0); }

    .video-wrapper { position: relative; padding-top: 177.78%; /* 9:16 */ background: #1a1a1a; }
    .video-wrapper video {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      object-fit: cover; background: #1a1a1a;
    }

    /* Placeholder رمادي زي تيك توك */
    video:not([src]), video[src=""] {
      background: #222 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="%23555" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.1-3.1a5.5 5.5 0 0 0-7.8 0L9 13"/></svg>') center/48px no-repeat;
    }

    .video-overlay {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.85));
      padding: 20px 12px 8px; color: #fff;
    }
    .video-overlay h3 { margin: 0; font-size: 15px; font-weight: 600; }
    .video-overlay p { margin: 4px 0 0; font-size: 13px; color: #2f61e0; }

    /* موبايل صغير */
    @media (max-width: 480px) {
      .grid-container { grid-template-columns: repeat(2, 1fr); gap: 6px; padding: 0 4px; }
      .search-input { width: 0; padding: 0; opacity: 0; }
      .search-container.active .search-input { width: 160px; padding: 8px 12px; opacity: 1; }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-container">
      <a href="/" class="logo">Capslank</a>
      <div class="search-container">
        <input type="text" class="search-input" placeholder="ابحث عن منتج..." />
        <button class="search-button">ج</button>
      </div>
    </div>
  </header>

  <!-- البنر (اختياري) -->
  <div class="full-width-banner" id="banner">
    <button class="close-banner" id="closeBanner">×</button>
    <div class="banner-slideshow" id="bannerSlideshow">
      <div class="banner-slide"><img src="Samsung ATIV Book 9 Plus Review.jpeg" alt="عرض 1" loading="lazy"></div>
      <div class="banner-slide"><img src="Instagram.jpeg" alt="عرض 2" loading="lazy"></div>
      <div class="banner-slide"><img src="(1) Instagram.jpeg" alt="عرض 3" loading="lazy"></div>
    </div>
  </div>

  <div class="grid-container" id="grid"></div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const grid = document.getElementById("grid");
      const searchInput = document.querySelector(".search-input");
      let products = [];

      // Banner slideshow
      const banner = document.getElementById("banner");
      const closeBtn = document.getElementById("closeBanner");
      if (closeBtn) closeBtn.onclick = () => banner.style.display = "none";
      let slideIndex = 0;
      const slides = document.querySelectorAll(".banner-slide");
      if (slides.length > 1) setInterval(() => {
        slideIndex = (slideIndex + 1) % slides.length;
        document.getElementById("bannerSlideshow").style.transform = `translateX(-${slideIndex * 100}%)`;
      }, 5000);

      // جلب المنتجات
      try {
        const res = await fetch("products.json");
        const data = await res.json();
        products = data.products || [];
      } catch (e) {
        grid.innerHTML = "<p style='text-align:center;color:#aaa;'>فشل تحميل المنتجات</p>";
        return;
      }

      // عرض المنتجات
      products.forEach((p, i) => {
        const item = document.createElement("div");
        item.className = "video-item";
        item.innerHTML = `
          <a href="product-detail.html?id=${p.id}" class="video-link">
            <div class="video-wrapper">
              <video 
                poster="https://placehold.co/720x1280/f0f0f0/cccccc" 
                preload="metadata" 
                playsinline 
                muted 
                loop>
                <source data-src="${p.video}" type="video/mp4">
              </video>
              <div class="video-overlay">
                <h3>${p.title}</h3>
                <p>${p.price.toFixed(2)} جنيه</p>
              </div>
            </div>
          </a>`;
        grid.appendChild(item);
      });

      // Lazy loading + تشغيل الفيديو لما يظهر
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const video = entry.target.querySelector("video");
            const source = video.querySelector("source");
            if (source && !source.src) {
              source.src = source.dataset.src;
              video.load();
            }
            video.play().catch(() => {});
            entry.target.classList.add("visible");
            observer.unobserve(entry.target);
          }
        });
      }, { rootMargin: "0px 0px 200px 0px", threshold: 0.3 });

      document.querySelectorAll(".video-item").forEach(el => observer.observe(el));

      // بحث
      searchInput.addEventListener("input", () => {
        const term = searchInput.value.trim().toLowerCase();
        document.querySelectorAll(".video-item").forEach(item => {
          const title = item.querySelector("h3").textContent.toLowerCase();
          item.style.display = title.includes(term) ? "block" : "none";
        });
      });
    });
  </script>
</body>
</html>