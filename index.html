<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Grid</title>
    <style>
      /* Full-width Image Banner with Multiple Photos */
      .full-width-banner {
        width: 100%;
        margin: 0 auto 15px;
        position: relative;
        overflow: hidden;
        max-height: 400px;
        border-radius: 2px;
        /* max-width: 1800px; */
      }
      
      .banner-slideshow {
        display: flex;
        transition: transform 0.5s ease-in-out;
        height: 100%;
      }
      
      .banner-slide {
        min-width: 100%;
        height: 200px;
        position: relative;
      }
      
      .banner-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        border-radius: 12px;
      }
      
      .close-banner {
        position: absolute;
        top: 1px;
        right: 1px;
        background: rgba(0, 0, 0, 0.6);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition:  0.3s;
      }
      
      .close-banner:hover {
        background: rgba(0, 0, 0, 0.8);
      }
      
      .close-ad {
        background: none;
        border: none;
        color: #999;
        cursor: pointer;
        padding: 5px;
        margin-left: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }
      
      .close-ad:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
      }
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background-color: #000000;
        font-family: Arial, sans-serif;
      }
      body::-webkit-scrollbar {
        display: none;
      }
      /* Header Styles */
      .header {
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 8px 15px;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .header-container {
        max-width: 1800px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 10px;
        height: 30px;
      }

      .logo {
        color: rgb(47, 97, 224);
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-size: 20px;
        text-decoration: none;
        white-space: nowrap;
        margin: 0;
        line-height: 1;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* Search container */
      .search-container {
        display: flex;
        align-items: center;
        position: relative;
        margin-left: auto;
        transition: all 0.3s ease;
        max-width: 400px;
        width: 100%;
        justify-content: flex-end;
      }

      /* Search input - responsive behavior */
      .search-input {
        width: 200px;
        padding: 5px 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 25px;
        font-size: 14px;
        outline: none;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
        height: 26px;
        margin-right: 8px;
      }
      
      .search-input:focus {
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 0 10px rgba(47, 97, 224, 0.3);
      }

      /* Mobile styles */
      @media (max-width: 768px) {
        .search-input {
          width: 0;
          padding: 0;
          border: none;
          position: absolute;
          right: 40px;
          opacity: 0;
          visibility: hidden;
          margin-right: 0;
        }

        .search-container.active .search-input {
          width: calc(100vw - 120px);
          max-width: 300px;
          padding: 8px 15px;
          opacity: 1;
          visibility: visible;
          border: 2px solid #333;
        }
      }

      /* Desktop styles */
      @media (min-width: 769px) {
        .search-input {
          width: 200px;
          padding: 8px 15px;
          opacity: 1;
          visibility: visible;
          position: static;
        }

        .search-input:focus {
          width: 300px;
        }
      }

      .search-button {
        background: blue;
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        padding: 0;
      }

      .search-button:hover {
        background: #0056b3;
      }

      .search-icon {
        width: 18px;
        height: 18px;
      }

      .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        max-width: 1800px;
        margin: 0 auto;
      }

      .video-item {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        background: #1a1a1a;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.5s ease;
        opacity: 0;
        transform: translateY(20px);
      }

      .video-item:hover {
        
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .video-link {
        display: block;
        width: 100%;
        height: 100%;
        text-decoration: none;
        color: inherit;
      }

      .video-link video {
        transition: opacity 0.3s ease;
      }

      .video-link:hover video {
        opacity: 0.9;
      }

      .video-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
      }

      .video-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
        color: white;
        padding: 15px 10px 5px;
        transition: all 0.3s ease;
      }

      .video-overlay h3 {
        margin: 0 0 5px 0;
        font-size: 14px;
        font-weight: 600;
      }

      .video-overlay p{
        color: blue;
        
        direction: rtl;
        margin: 0 0 8px 0;
        font-size: 12px;
        opacity: 0.9;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        /* Standard property for better compatibility */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        max-height: 2.4em; /* Fallback for line-clamp */
        line-height: 1.2em;
      }

      @supports (-webkit-line-clamp: 2) {
        .video-overlay p {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
        }
      }

      .video-stats {
        display: flex;
        gap: 12px;
        font-size: 12px;
        opacity: 0.8;
      }

      .video-stats span {
        display: flex;
        align-items: center;
        gap: 3px;
      }

      .video-item:hover .video-overlay {
        padding-bottom: 10px;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.85));
      }

      video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
/* 
      h1 {
        position: absolute;
        bottom: 10px;
        left: 10px;
        color: white;
        margin: 0;
        font-size: 14px;
        font-weight: 500;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        z-index: 2;
        text-align: left;
        padding: 5px 10px;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        max-width: calc(100% - 40px);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      } */

      @media (max-width: 767px) {
        .grid-container {
          grid-template-columns: repeat(auto-fill, minmax(150px, 3fr));
          gap: 7px;
        }

        .header-container {
          flex-wrap: nowrap;
        }

        .logo {
          margin-bottom: 0;
        }

        .search-container {
          margin-left: auto;
        }

        .search-input:focus {
          width: 200px !important;
          padding: 0 15px !important;
          opacity: 1 !important;
          visibility: visible !important;
          border: 2px solid #333 !important;
        }
      }

      @media (min-width: 320px) and (max-width: 470px) {
        /* Header adjustments */
        .header {
          padding: 5px 0;
          height: 40px;
        }
        
        .header-container {
          height: 30px;
          padding: 0 10px;
        }
        
        .logo {
          font-size: 16px;
          
          
        }
        h1{
          padding-bottom: 10px;
        }
        
        .search-button {
          width: 30px;
          height: 30px;
          border-radius: 4px;
        }
        
        .search-container {
          margin-left: auto;
        }
        
        .search-input {
          border-radius: 4px;
          height: 30px;
          padding: 0 10px;
          width: 30px;
          transition: all 0.3s ease;
        }
        
        .search-input:focus {
          width: 150px !important;
          padding: 0 10px !important;
        }
        
        .search-icon {
          width: 16px;
          height: 16px;
        }
        
        /* Hide close button */
        .search-container .close-icon {
          display: none;
        }
        .close-banner{
          display: none;
        }
        
        /* Update slide banner styles */
        .full-width-banner {
          border-radius: 4px;
          margin: 0 5px 15px;
          width: calc(100% - 10px); /* Match grid container width */
          overflow: hidden;
          box-sizing: border-box;
        }
        
        /* Ensure close button is hidden */
        .close-button, .close-icon {
          display: none !important;
        }
         
        
        
        /* Grid and video item adjustments */
        .grid-container {
          display: block;
          column-count: 2;
          width: 100%;
          column-gap: 5px;
          column-fill: balance;
          padding: 0 5px;
        }
        .video-item {
          margin-bottom: 5px;
          aspect-ratio: unset;
          height: fit-content; /* Fixed height for small devices */
          border-radius: 4px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .video-item h3 {
          font-size: 12px;
          margin: 5px 0;
          padding: 0 5px;
          line-height: 1.2;
        }
        
        .video-item p {
          font-size: 10px;
          margin: 2px 0;
          padding: 0 5px;
          color: #0346ff;
        }
        .video-wrapper,
        .video-link,
        .video-link video {
          height: 100%;
          width: 100%;
          object-fit: cover; /* Ensure video covers the area */
        }
      }
    </style>
  </head>
  <body style="margin: 0; padding: 0; width: 100%; overflow-x: hidden;">
    <header class="header">
      <div class="header-container">
        <h1><a href="/" class="logo">Capslank</a></h1>

        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Search products..."
            aria-label="Search products"
          />
          <button class="search-button" aria-label="Search">
            <svg
              class="search-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <div  style="padding: 2px">
      <!-- Full-width Banner with Multiple Photos -->
      <div class="full-width-banner" id="banner">
        <button class="close-banner" id="closeBanner" aria-label="Close banner">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div class="banner-slideshow" id="bannerSlideshow">
          <div class="banner-slide">
            <img src="Samsung ATIV Book 9 Plus Review.jpeg" alt="Product 1" loading="lazy">
          </div>
          <!-- Add more slides as needed -->
          <div class="banner-slide">
            <img src="Instagram.jpeg" alt="Product 2" loading="lazy">
          </div>
          <div class="banner-slide">
            <img src="(1) Instagram.jpeg" alt="Product 3" loading="lazy">
          </div>
        </div>
      </div>

      <div class="grid-container">
        <!-- Video items will be generated here -->
    </div>

    <script>
      // Main content script - runs when DOM is fully loaded
      document.addEventListener("DOMContentLoaded", async function () {
        // Banner slideshow functionality
        const banner = document.getElementById('banner');
        const slideshow = document.getElementById('bannerSlideshow');
        const closeButton = document.getElementById('closeBanner');
        let currentSlide = 0;
        
        // Initialize banner slideshow if it exists
        if (slideshow) {
          // Close banner
          if (closeButton) {
            closeButton.addEventListener('click', function() {
              banner.style.display = 'none';
            });
          }
          
          // Auto-advance slides
          function nextSlide() {
            const slides = document.querySelectorAll('.banner-slide');
            if (slides.length > 0) {
              currentSlide = (currentSlide + 1) % slides.length;
              slideshow.style.transform = `translateX(-${currentSlide * 100}%)`;
            }
          }
          
          // Change slide every 5 seconds if we have slides
          const slides = document.querySelectorAll('.banner-slide');
          if (slides.length > 0) {
            setInterval(nextSlide, 5000);
          }
        }

        // Main grid and search functionality
        const gridContainer = document.querySelector(".grid-container");
        const searchContainer = document.querySelector(".search-container");
        const searchInput = document.querySelector(".search-input");
        const searchButton = document.querySelector(".search-button");
        
        if (!gridContainer || !searchContainer || !searchInput || !searchButton) {
          console.error("Required elements not found in the DOM");
          return;
        }
        
        let productsData = []; // Store products for search functionality
        let currentPlayingVideo = null; // Track currently playing video for mobile
        let currentHoveredVideo = null; // Track hovered video for desktop

        // Toggle search on mobile
        searchButton.addEventListener("click", function (e) {
          if (window.innerWidth < 768) {
            e.preventDefault();
            searchContainer.classList.toggle("active");
            if (searchContainer.classList.contains("active")) {
              searchInput.focus();
            }
          } else {
            // On desktop, perform search on button click
            performSearch();
          }
        });

        // Close search when clicking outside
        document.addEventListener("click", function (e) {
          if (
            window.innerWidth < 768 &&
            !searchContainer.contains(e.target) &&
            e.target !== searchButton
          ) {
            searchContainer.classList.remove("active");
          }
        });

        // Close search on escape key
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && searchContainer.classList.contains("active")) {
            searchContainer.classList.remove("active");
          }
        });

        // Search functionality
        searchInput.addEventListener("input", performSearch);

        // Function to perform search
        function performSearch() {
          const searchTerm = searchInput.value.trim().toLowerCase();
          const videoItems = document.querySelectorAll(".video-item");

          if (!searchTerm) {
            // If search is empty, show all items
            videoItems.forEach((item) => {
              item.style.display = "block";
            });
            return;
          }

          // Search through products
          const filteredProducts = productsData.filter((product) => {
            const title = product.title?.toLowerCase() || "";
            const price = product.price?.toString() || "";
            return (
              title.includes(searchTerm) ||
              price.includes(searchTerm) ||
              title.includes(searchTerm.replace(/\s+/g, " ").trim())
            );
          });

          // Hide all items first
          videoItems.forEach((item) => {
            item.style.display = "none";
          });

          // Show only matching items
          filteredProducts.forEach((product) => {
            const item = document.querySelector(`.video-item a[href="product-detail.html?id=${product.id}"]`)?.parentElement;
            if (item) {
              item.style.display = "block";
            }
          });
        }

        // Load products and initialize the page
        try {
          // Fetch products from the external JSON file
          const response = await fetch("products.json");
          if (!response.ok) {
            throw new Error("Failed to load products");
          }
          const data = await response.json();
          productsData = data.products || [];

          // Create video items for each product
          productsData.forEach((product, index) => {
            const videoItem = document.createElement("div");
            videoItem.className = "video-item";
            videoItem.style.transitionDelay = `${index * 0.05}s`;

            videoItem.innerHTML = `
              <a href="product-detail.html?id=${product.id}" class="video-link">
                <div class="video-wrapper">
                  <video loop muted playsinline preload="none" data-src="${product.video}">
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>
                  <div class="video-overlay">
                    <h3>${product.title}</h3>
                    <p>${product.price.toFixed(2)}جنية</p>
                  </div>
                </div>
              </a>
            `;
            gridContainer.appendChild(videoItem);

            // Initialize video element
            const video = videoItem.querySelector('video');
            if (video) {
              video.muted = true;
              video.volume = 0;
              video.pause();
            }
          });

          // Initialize Intersection Observer for lazy loading and animations
          const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const videoItem = entry.target;
                // Fade in animation
                videoItem.style.opacity = '1';
                videoItem.style.transform = 'translateY(0)';
                
                // Lazy load video
                const video = videoItem.querySelector('video');
                if (video && !video.getAttribute('data-loaded')) {
                  const src = video.getAttribute('data-src');
                  if (src) {
                    video.querySelector('source').src = src;
                    video.load();
                    video.setAttribute('data-loaded', 'true');
                  }
                }
                
                observer.unobserve(videoItem);
              }
            });
          }, {
            threshold: 0.1,
            rootMargin: '0px 0px 100px 0px'
          });

          // Observe all video items
          document.querySelectorAll('.video-item').forEach(item => {
            observer.observe(item);
            
            // Set up hover events for desktop
            if (window.innerWidth > 768) {
              const video = item.querySelector('video');
              if (video) {
                item.addEventListener('mouseenter', () => handleVideoHover(video));
                item.addEventListener('mouseleave', () => handleVideoLeave(video));
              }
            }
          });

          // Initialize video playback for mobile
          if (window.innerWidth <= 768) {
            window.addEventListener('scroll', throttle(handleVideoPlayback, 200));
            window.addEventListener('resize', throttle(handleVideoPlayback, 200));
            handleVideoPlayback();
          }

        } catch (error) {
          console.error("Error loading products:", error);
          if (gridContainer) {
            gridContainer.innerHTML = "<p>Error loading products. Please try again later.</p>";
          }
        }

        // Function to handle video hover (desktop)
        function handleVideoHover(video) {
          if (currentHoveredVideo && currentHoveredVideo !== video) {
            currentHoveredVideo.pause();
            currentHoveredVideo.currentTime = 0;
          }
          video.play().catch(e => console.log("Video play failed:", e));
          currentHoveredVideo = video;
        }

        // Function to handle video leave (desktop)
        function handleVideoLeave(video) {
          if (video !== document.querySelector('.video-item video[data-playing]')) {
            video.pause();
            video.currentTime = 0;
          }
        }

        // Function to check if element is in viewport
        function isInViewport(element) {
          const rect = element.getBoundingClientRect();
          const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
          return (
            rect.top >= -rect.height * 0.5 &&
            rect.bottom <= viewportHeight + rect.height * 0.5
          );
        }

        // Function to handle video playback (mobile)
        function handleVideoPlayback() {
          // Only handle mobile devices (320px - 768px)
          if (window.innerWidth > 768) return;
          
          const videos = Array.from(document.querySelectorAll('.video-item video[data-loaded]'));
          const visibleVideos = videos.filter(video => isInViewport(video));
          
          // If no videos are visible, pause the current one
          if (visibleVideos.length === 0) {
            if (currentPlayingVideo) {
              currentPlayingVideo.pause();
              currentPlayingVideo.removeAttribute('data-playing');
              currentPlayingVideo = null;
            }
            return;
          }
          
          // Find the most centered video
          const viewportCenter = window.innerHeight / 2;
          const { video: closestVideo } = visibleVideos.reduce((closest, video) => {
            const rect = video.getBoundingClientRect();
            const videoCenter = rect.top + rect.height / 2;
            const distance = Math.abs(viewportCenter - videoCenter);
            return distance < closest.distance ? { video, distance } : closest;
          }, { video: null, distance: Infinity });
          
          // If we have a new video to play and it's not the current one
          if (closestVideo && currentPlayingVideo !== closestVideo) {
            // Pause current video if it exists
            if (currentPlayingVideo) {
              currentPlayingVideo.pause();
              currentPlayingVideo.currentTime = 0;
              currentPlayingVideo.removeAttribute('data-playing');
            }
            
            // Play the new video if it's loaded
            if (closestVideo.readyState >= 2) {
              closestVideo.play().catch(e => console.log('Autoplay prevented:', e));
              closestVideo.setAttribute('data-playing', 'true');
              currentPlayingVideo = closestVideo;
            }
          }
        }

        // Throttle function for scroll/resize events
        function throttle(callback, limit) {
          let waiting = false;
          return function() {
            if (!waiting) {
              callback.apply(this, arguments);
              waiting = true;
              setTimeout(() => {
                waiting = false;
              }, limit);
            }
          };
        }

      }); // End of DOMContentLoaded
    </script>
  </body>
</html>